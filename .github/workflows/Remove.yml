name: Remove CN IPs

on:
  push:
    branches:
      - main # 可以根据实际情况调整触发条件

jobs:
  remove_cn_ips_job:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      
- name: 生成 IP 地址对应国家代码
  run: |
      > Fission_ip2cc.txt
      while IFS= read -r line
      do
        ip=$(echo "$line" | grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b")
        country_code=$(mmdblookup --file GeoLite2-Country.mmdb --ip "$ip" country iso_code | awk -F'"' '{print \$2}' | tr -d '\n')
        echo "$line#$country_code" >> Fission_ip2cc.txt
      done < Fission_ip.txt
